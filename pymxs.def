Bootstrap: docker
# From: continuumio/miniconda3:22.11.1
From: nvidia/cuda:11.8.0-devel-ubuntu20.04

# install python3-pip
# RUN apt update && apt install python3-pip -y

# RUN pip install "jax[cuda11_cudnn86]" -f https://storage.googleapis.com/jax-releases/jax_cuda_releases.html

%files
./analysis_scripts /app/analysis_scripts
./gym_mxs /app/gym_mxs
./inertia /app/inertia
./models /app/models
./processing_scripts /app/processing_scripts
./pyaerso /app/pyaerso
./pymxs_sbx_run.py /app/pymxs_sbx_run.py

%post

  apt update && apt install python3-pip -y
  bash -c "
    # Install the mxs gym environment into the conda environment
    cd /app/gym_mxs
    pip3 install -e .
  "
  pip3 install sbx-rl==0.5.0
  # pip3 install "jax[cuda11_cudnn86]" -f https://storage.googleapis.com/jax-releases/jax_cuda_releases.html
  pip3 install --upgrade "jax[cuda11_pip]" -f https://storage.googleapis.com/jax-releases/jax_cuda_releases.html
  pip3 install dm-control
  pip3 install wandb
  pip3 install tensorboard

%environment
  export WANDB_API_KEY="ea17412f95c94dfcc41410f554ef62a1aff388ab"

%runscript
  #!/usr/bin/env bash
  exec python3 /app/pymxs_sbx_run.py $@
